<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Optimisation Circulation - VOTRE Implantation Actuelle</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Crect width='24' height='24' fill='%231a1a1a'/%3E%3Cpath d='M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5' stroke='%238AFD81' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      background: #1a1a1a;
      color: white;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      color: #8AFD81;
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    
    .subtitle {
      color: #888;
      font-size: 14px;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 24px;
      background: #2a2a2a;
      border: 2px solid #8AFD81;
      color: #8AFD81;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: #8AFD81;
      color: #1a1a1a;
    }
    
    .btn.active {
      background: #8AFD81;
      color: #1a1a1a;
    }
    
    .container {
      max-width: 1800px;
      margin: 0 auto;
      background: #2a2a2a;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }
    
    .plan-wrapper {
      position: relative;
      width: 100%;
      margin-bottom: 30px;
      background: #1a1a1a;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .plan {
      width: 100%;
      height: 900px;
      background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
      position: relative;
      border: 4px solid #333;
    }
    
    /* Grille de fond */
    .plan::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(138, 253, 129, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(138, 253, 129, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
      pointer-events: none;
    }
    
    /* Éléments sur le plan */
    .element {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .element:hover {
      transform: scale(1.05);
      filter: brightness(1.2);
      z-index: 100;
    }
    
    .label {
      text-shadow: 0px 0px 3px rgba(0,0,0,0.9);
      pointer-events: none;
      white-space: nowrap;
    }
    
    /* Types d'éléments - VOTRE IMPLANTATION */
    .transformer {
      background: rgba(33, 150, 243, 0.7);
      border: 2px solid #2196F3;
      z-index: 3;
    }
    
    .container-elem {
      background: rgba(138, 253, 129, 0.5);
      border: 2px solid #8AFD81;
      z-index: 2;
    }
    
    .concrete-slab {
      background: rgba(158, 158, 158, 0.4);
      border: 2px solid #9E9E9E;
      z-index: 1;
    }
    
    /* Allées de circulation béton - AJOUTÉES */
    .circulation-main {
      background: rgba(255, 193, 7, 0.4);
      border: 3px solid #FFC107;
      z-index: 0;
      box-shadow: inset 0 0 10px rgba(255, 193, 7, 0.3);
    }
    
    .circulation-perimeter {
      background: rgba(255, 193, 7, 0.25);
      border: 2px solid #FFD54F;
      z-index: 0;
      box-shadow: inset 0 0 6px rgba(255, 193, 7, 0.2);
    }
    
    /* Périmètre de sécurité - Barrière */
    .security-perimeter {
      border: 4px solid #FF5722;
      background: rgba(255, 87, 34, 0.05);
      z-index: 0;
      box-shadow: 0 0 20px rgba(255, 87, 34, 0.3);
    }
    
    /* Zone d'entrée avec contrôle d'accès */
    .entrance-zone {
      background: rgba(76, 175, 80, 0.2);
      border: 3px solid #4CAF50;
      z-index: 1;
    }
    
    .gate {
      background: rgba(255, 193, 7, 0.7);
      border: 3px solid #FFC107;
      z-index: 2;
    }
    
    .guard-post {
      background: rgba(33, 150, 243, 0.7);
      border: 2px solid #2196F3;
      z-index: 2;
    }
    
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 5px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .legend-color {
      width: 30px;
      height: 30px;
      border: 2px solid;
      border-radius: 3px;
    }
    
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .metric-card {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 5px;
      border: 2px solid #333;
    }
    
    .metric-card h3 {
      color: #8AFD81;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
    }
    
    .metric-value {
      font-size: 2em;
      font-weight: bold;
      color: white;
    }
    
    .metric-label {
      color: #888;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Optimisation Circulation - VOTRE Implantation</h1>
    <p class="subtitle">Allées béton ajoutées autour de votre disposition actuelle (6 transformateurs + 12 containers)</p>
  </div>
  
  <div class="controls">
    <button class="btn active" onclick="showView('without', event)">Sans Allées</button>
    <button class="btn" onclick="showView('with', event)">Avec Allées Béton</button>
  </div>
  
  <div class="container">
    <div class="plan-wrapper">
      <div id="plan" class="plan"></div>
    </div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(33, 150, 243, 0.7); border-color: #2196F3;"></div>
        <span>Transformateur PT-Substation</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(138, 253, 129, 0.5); border-color: #8AFD81;"></div>
        <span>Container ANTSPACE HD5</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(158, 158, 158, 0.4); border-color: #9E9E9E;"></div>
        <span>Dalle Béton 40cm</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(255, 193, 7, 0.4); border: 3px solid #FFC107;"></div>
        <span>Allée Principale Béton (6m)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(255, 193, 7, 0.25); border: 2px solid #FFD54F;"></div>
        <span>Allée Périmétrique Béton (3m)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(255, 87, 34, 0.05); border: 4px solid #FF5722;"></div>
        <span>Périmètre Sécurité (Barrière)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(76, 175, 80, 0.2); border: 3px solid #4CAF50;"></div>
        <span>Zone d'Entrée</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(255, 193, 7, 0.7); border: 3px solid #FFC107;"></div>
        <span>Portail d'Accès</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(33, 150, 243, 0.7); border: 2px solid #2196F3;"></div>
        <span>Poste de Garde</span>
      </div>
    </div>
    
    <div class="metrics" id="metrics">
      <!-- Métriques calculées dynamiquement -->
    </div>
  </div>
  
  <script>
    // VOTRE IMPLANTATION ACTUELLE (vue dans le viewer 3D)
    // 6 transformateurs en 2 rangées de 3
    // 12 containers (2 par transformateur)
    
    const SCALE = 6; // pixels par mètre (réduit pour tout faire rentrer)
    const OFFSET_X = 100;
    const OFFSET_Y = 50;
    
    // Dimensions réelles
    const DIMS = {
      transformer: { w: 2.5, h: 2.5 },
      container: { w: 12.196, h: 2.896 },
      concreteSlab: { w: 13, h: 3.5 }
    };
    
    // Allées de circulation
    const CIRCULATION = {
      main: 6,       // Allée principale
      perimeter: 3   // Allée périmétrique autour containers
    };
    
    // NOUVELLE IMPLANTATION - Tous sur la ligne horizontale y=50
    // GAUCHE: 12 Containers (2 par transformateur)
    // DROITE: 6 Transformateurs alignés
    const transformers = [
      { id: 'TT1', x: 95, y: 50 },   // Transformateurs côté DROIT
      { id: 'TT2', x: 102, y: 50 },
      { id: 'TT3', x: 109, y: 50 },
      { id: 'TT4', x: 116, y: 50 },
      { id: 'TT5', x: 123, y: 50 },
      { id: 'TT6', x: 130, y: 50 }
    ];
    
    // 12 Containers (2 par transformateur) côté GAUCHE
    const containers = [
      { id: 'TT1_A', x: 10, y: 50, transformer: 'TT1' },
      { id: 'TT1_B', x: 17, y: 50, transformer: 'TT1' },
      { id: 'TT2_A', x: 24, y: 50, transformer: 'TT2' },
      { id: 'TT2_B', x: 31, y: 50, transformer: 'TT2' },
      { id: 'TT3_A', x: 38, y: 50, transformer: 'TT3' },
      { id: 'TT3_B', x: 45, y: 50, transformer: 'TT3' },
      { id: 'TT4_A', x: 52, y: 50, transformer: 'TT4' },
      { id: 'TT4_B', x: 59, y: 50, transformer: 'TT4' },
      { id: 'TT5_A', x: 66, y: 50, transformer: 'TT5' },
      { id: 'TT5_B', x: 73, y: 50, transformer: 'TT5' },
      { id: 'TT6_A', x: 80, y: 50, transformer: 'TT6' },
      { id: 'TT6_B', x: 87, y: 50, transformer: 'TT6' }
    ];
    
    let currentView = 'without';
    
    function toScreen(x, y) {
      return {
        x: x * SCALE + OFFSET_X,
        y: y * SCALE + OFFSET_Y
      };
    }
    
    function drawElement(type, x, y, w, h, className, label = '') {
      const pos = toScreen(x, y);
      const width = w * SCALE;
      const height = h * SCALE;
      
      const elem = document.createElement('div');
      elem.className = `element ${className}`;
      elem.style.left = (pos.x - width/2) + 'px';
      elem.style.top = (pos.y - height/2) + 'px';
      elem.style.width = width + 'px';
      elem.style.height = height + 'px';
      
      if (label) {
        const labelElem = document.createElement('div');
        labelElem.className = 'label';
        labelElem.textContent = label;
        elem.appendChild(labelElem);
      }
      
      document.getElementById('plan').appendChild(elem);
    }
    
    function drawSecurityPerimeter() {
      if (currentView !== 'with') return;
      
      // Barrière périmétrique pour disposition HORIZONTALE
      // Container gauche: x=10 → bord gauche ≈ 3m
      // Transformateur droit: x=130 → bord droit ≈ 133m
      // Ligne y=50 ± marges (containers + périmètres 3m)
      const perimX = 70;    // Centre X
      const perimY = 50;    // Centre Y (ligne principale)
      const perimW = 140;   // Largeur totale pour tout contenir
      const perimH = 18;    // Hauteur (container 2.9m + périmètres 3m x2 + marges)
      drawElement('perimeter', perimX, perimY, perimW, perimH, 'security-perimeter', '');
    }
    
    function drawEntranceZone() {
      if (currentView !== 'with') return;
      
      // Zone d'entrée à GAUCHE (début de la ligne)
      const entranceX = 5;
      const entranceY = 50;
      drawElement('entrance', entranceX, entranceY, 8, 8, 'entrance-zone', '');
      
      // Portail d'entrée
      drawElement('gate', entranceX + 2, entranceY, 2, 6, 'gate', 'PORTAIL');
      
      // Poste de garde
      drawElement('guard', entranceX, entranceY - 6, 4, 4, 'guard-post', 'GARDE');
    }
    
    function drawCirculation() {
      if (currentView !== 'with') return;
      
      // Allée principale HORIZONTALE sur toute la longueur (y=50)
      drawElement('circulation', 70, 50, 130, CIRCULATION.main, 'circulation-main', '');
      
      // Allées périmétriques autour de chaque container (12 containers)
      containers.forEach(cont => {
        const perimW = DIMS.container.w + CIRCULATION.perimeter * 2;
        const perimH = DIMS.container.h + CIRCULATION.perimeter * 2;
        drawElement('circulation', cont.x, cont.y, perimW, perimH, 'circulation-perimeter', '');
      });
    }
    
    function renderView() {
      const plan = document.getElementById('plan');
      plan.innerHTML = '';
      
      // 1. PÉRIMÈTRE DE SÉCURITÉ (en premier, en arrière-plan)
      drawSecurityPerimeter();
      
      // 2. ZONE D'ENTRÉE
      drawEntranceZone();
      
      // 3. Allées de circulation
      drawCirculation();
      
      // 4. Dalles béton
      containers.forEach(cont => {
        drawElement('concrete', cont.x, cont.y, DIMS.concreteSlab.w, DIMS.concreteSlab.h, 'concrete-slab', '');
      });
      
      // 5. Containers
      containers.forEach(cont => {
        drawElement('container', cont.x, cont.y, DIMS.container.w, DIMS.container.h, 'container-elem', cont.id.split('_')[1]);
      });
      
      // 6. Transformateurs
      transformers.forEach(tr => {
        drawElement('transformer', tr.x, tr.y, DIMS.transformer.w, DIMS.transformer.h, 'transformer', tr.id);
      });
      
      // Métriques
      updateMetrics();
    }
    
    function updateMetrics() {
      const withCirculation = currentView === 'with';
      
      let circulationArea = 0;
      let concreteVolume = 0;
      
      if (withCirculation) {
        // Allée principale horizontale (6m de large sur ~130m de long)
        circulationArea += CIRCULATION.main * 130;
        
        // Allées périmétriques autour de chaque container (12 containers)
        // Surface périmétrique = périmètre × largeur allée
        const containerPerimeter = 2 * (DIMS.container.w + DIMS.container.h);
        circulationArea += containerPerimeter * CIRCULATION.perimeter * 12;
        
        // Volume béton (25cm épaisseur)
        concreteVolume = circulationArea * 0.25;
      }
      
      document.getElementById('metrics').innerHTML = `
        <div class="metric-card">
          <h3>Transformateurs</h3>
          <div class="metric-value">6</div>
          <div class="metric-label">PT-Substation Ultra</div>
        </div>
        <div class="metric-card">
          <h3>Containers</h3>
          <div class="metric-value">12</div>
          <div class="metric-label">ANTSPACE HD5</div>
        </div>
        <div class="metric-card">
          <h3>Surface Béton Circulation</h3>
          <div class="metric-value">${circulationArea.toFixed(0)} m²</div>
          <div class="metric-label">${withCirculation ? 'Allées ajoutées' : 'Aucune allée'}</div>
        </div>
        <div class="metric-card">
          <h3>Volume Béton Requis</h3>
          <div class="metric-value">${concreteVolume.toFixed(0)} m³</div>
          <div class="metric-label">Épaisseur 25cm</div>
        </div>
        <div class="metric-card">
          <h3>Accès Maintenance</h3>
          <div class="metric-value">${withCirculation ? 'Complet' : 'Limité'}</div>
          <div class="metric-label">${withCirculation ? 'Accès 360° béton' : 'Sans allées'}</div>
        </div>
      `;
    }
    
    function showView(view, event) {
      currentView = view;
      document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
      if (event && event.target) {
        event.target.classList.add('active');
      }
      renderView();
    }
    
    // Initialisation
    renderView();
  </script>
</body>
</html>

